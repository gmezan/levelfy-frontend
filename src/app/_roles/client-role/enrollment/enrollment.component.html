<section class='py-2 bg-light'>
    <div class="container py-5">
        <div class="row">
            <!-- "sidebar" -->
            <div class="col-lg-2">
                <ul class="mb-1 list-group list-group-flush list-group-careers">
                    <li class="list-group-item pt-0 bg-light">
                        <a style="color: #0D9814;" class="small" [routerLink]="['/c/enrollment']">
                            <fa-icon class="mr-1" [icon]="['fas','arrow-left']"></fa-icon>Ir a mis cursos</a>
                    </li>
                    <li class="list-group-item bg-light font-weight-bold">{{ enrollment.service.serviceType | serviceTypeString }}</li>
                </ul>
            </div>

            <!-- Content -->
            <div class="col-lg-10 ">

                <div class='container'>
                    <ng-template appCustomAlert></ng-template>
                </div>

                <div class="card no-transition rounded-lg text-dark bg-white">
                    <div class="card-body mx-3 my-2">
                        <ng-container [ngSwitch]="serviceType?.key">
                            <!-- Go to ../../../levelfy/util/services-types to check if the order is correct -->
                            <ng-container *ngSwitchCase="'ASES_PER'">
                                <ng-container *ngTemplateOutlet='formAsesPer'></ng-container>
                            </ng-container>
                            <ng-container *ngSwitchCase="'ASES_PAQ'">
                                <ng-container *ngTemplateOutlet='formAsesPaq'></ng-container>
                            </ng-container>
                            <ng-container *ngSwitchCase="'MAR'">
                                <ng-container *ngTemplateOutlet='formMar'></ng-container>
                            </ng-container>
                        </ng-container>

                    </div>
                </div>
            </div>
        </div>
    </div>

</section>

<div class="modal fade" id="modalPayment" role="dialog">
    <div class="modal-dialog">
        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Registrar pago</h4>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <form [formGroup]='form'>
                <div class="modal-body">
                    <div class="form-group">
                        <p class="text-dark">Envía el registro de pago una vez realizado el mismo, si tienes alguna consulta, duda o hubo algún problema, puedes contactarnos mediante el siguiente correo
                            <b><span> {{ emailSupport }} </span></b>.<br> Verificaremos la operación en breve.</p>
                    </div>

                    <div class="form-row" >
                        <div class="form-group col-md-6">
                            <label class="small text-gray-600" for="leadCapFirstName">Nombre de persona que realizó el pago</label>
                            <input class="form-control rounded-pill" formControlName='persona' id="leadCapFirstName"  type="text" />
                            <div class='alert alert-danger p-1' *ngIf="form.get('persona').touched && form.get('persona').invalid">
                                <div *ngIf="form.get('persona').errors.required">Se requiere el nombre</div>
                            </div>
                        </div>
                        <div class="form-group col-md-6">
                            <label class="small text-gray-600" for="leadCapFirstName">Fecha en la que se realizó la operación</label>
                            <input class="form-control rounded-pill" formControlName='date' type="datetime-local" />
                            <div class='alert alert-danger p-1' *ngIf="form.get('date').touched && form.get('date').invalid">
                                <div *ngIf="form.get('date').errors.required">Se requiere la fecha</div>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="small text-gray-600" >Correo electrónico</label>
                        <input class="form-control rounded-pill" formControlName='email' type="email" />
                        <div class='alert alert-danger p-1' *ngIf="form.get('email').touched && form.get('email').invalid">
                            <div *ngIf="form.get('email').errors.required">Se requiere el email</div>
                            <div *ngIf="form.get('email').errors.email">Ingrese un email válido</div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="small text-gray-600" >Mensaje o número de operación</label>
                        <input class="form-control rounded-pill" formControlName='message' type="text" />
                        <div class='alert alert-danger p-1' *ngIf="form.get('message').touched && form.get('message').invalid">
                            <div>Longitud máxima: 256 caracteres</div>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group col-md-6">
                            <label class="small text-gray-600" >Monto en S/. (ejemplo: "25.50")</label>
                            <input type="number" step="0.01" class="form-control rounded-pill"  formControlName='amount' />
                            <div class='alert alert-danger p-1' *ngIf="form.get('amount').touched && form.get('amount').invalid">
                                <div *ngIf="form.get('amount').errors.required">Se requiere el monto</div>
                                <div *ngIf="form.get('amount').errors.min">Valor mínimo: 0</div>
                                <div *ngIf="form.get('amount').errors.max">Valor máximo: 99999</div>
                            </div>
                        </div>
                        <div class="form-group col-md-6"><label class="small text-gray-600" >Método de pago</label>
                            <select class="form-control rounded-pill custom-select" formControlName='method'>
                                <option>-- Selecciona --</option>
                                <option [value]="'YAPE'" >Yape</option>
                                <option [value]="'PLIN'">Plin</option>
                                <option [value]="'LUKITA'">Lukita</option>
                                <option [value]="'DEPOSITO_BCP'">Depósito a BCP</option>
                                <option [value]="'DEPOSITO_BBVA'">Depósito a cuenta BBVA</option>
                            </select>
                            <div class='alert alert-danger p-1' *ngIf="form.get('method').touched && form.get('method').invalid">
                                <div *ngIf="form.get('method').errors.required">Se requiere el método</div>
                            </div>
                        </div>
                    </div>

                </div>
                <div class="modal-footer">
                    <button (click)='submitForm()'
                            [disabled]='!form.dirty || form.invalid'
                            type='button'
                            data-dismiss="modal"
                            class="btn btn-black btn-marketing btn-block rounded-pill">Enviar</button>
                </div>
            </form>
        </div>

    </div>
</div>

<ng-template #formAsesPer>

</ng-template>

<ng-template #formAsesPaq>
    <h1 class="font-weight-bolder text">{{enrollment.service.course.name}}</h1>
    <h5 class="small text-green" style="color: #0D9814;">{{enrollment.service.course.courseId.university | universityString}}</h5>
    <div class="row my-3">
        <div class="col-lg-6 my-1">
            <a class="d-block rounded-lg text-center" ><img class="img-fluid rounded-lg" [src]="enrollment.service.teacher.photo"/></a>
        </div>
        <div class="col-lg-6 my-1">
            <div class="form-group">
                <h6 class="mb-3">Tendrás:</h6>
                <ul class="fa-ul">
                    <li *ngFor="let str of serviceType?.offers" class="mb-3">
                            <span class="fa-li">
                                <fa-icon [icon]="['far','dot-circle']"></fa-icon>
                            </span>
                        {{str}}
                    </li>
                </ul>
            </div>
        </div>
    </div>

    <form>
        <div class="form-row">
            <div class="form-group col-md-6"><label class="small text-gray-600" >Asesor</label>
                <select class="form-control rounded-pill custom-select" >
                    <option selected >{{enrollment.service.teacher.fullName}}</option>
                </select>
            </div>
            <div class="form-group col-md-6"><label class="small text-gray-600">Evaluacion</label>
                <select class="form-control rounded-pill custom-select" >
                    <option selected>{{ enrollment.service.evaluation | evaluationString }}</option>
                </select>
            </div>
        </div>

        <div class="form-row">
            <div class="form-group col-md-6"><label class="small text-gray-600" >Inversión</label>
                <select class="form-control rounded-pill custom-select" >
                    <option selected >{{enrollment.service.price | priceTagString}}</option>
                </select>
            </div>

        </div>

        <div class="form-group">
            <label class="small text-gray-600">Horarios</label>
            <table class='table'>
                <thead>
                <tr>
                    <th>Fecha</th>
                    <th>Hora inicio</th>
                    <th>Hora fin</th>
                </tr>
                </thead>
                <tbody>
                <tr *ngFor='let session of enrollment.service.serviceSessionList'>
                    <td>{{session.date | date: 'mediumDate'}}</td>
                    <td>{{session.start }}</td>
                    <td>{{session.end }}</td>
                </tr>
                </tbody>
            </table>
        </div>

        <app-payment-info [enrollment]='enrollment'></app-payment-info>

        <ng-container *ngIf='!enrollment.payed'>
            <ng-container *ngTemplateOutlet='paymentButton'></ng-container>
        </ng-container>

    </form>
</ng-template>

<ng-template #formMar>

</ng-template>

<ng-template #paymentButton>
    <!-- Always here -->
    <div class="form-row pt-4">
        <div class="form-group col-md-12">
            <div  class="card no-transition bg-light shadow-none">
                <div class="card-body d-flex align-items-center justify-content-between p-4">
                    <p class="lead mb-0">{{messageForTheButton}}</p>
                    <button class="btn btn-black btn-marketing rounded-pill ml-2" type="button" data-toggle="modal" data-target="#modalPayment">Registrar pago</button>
                </div>
            </div>
        </div>
    </div>
</ng-template>
